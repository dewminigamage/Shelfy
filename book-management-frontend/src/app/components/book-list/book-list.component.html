<!-- Toast Notification -->
<div
  class="toast"
  [class.toast--visible]="toast.visible"
  [class.toast--error]="toast.type === 'error'"
>
  <span class="toast-icon">
    <svg
      *ngIf="toast.type === 'success'"
      xmlns="http://www.w3.org/2000/svg"
      width="20"
      height="20"
      viewBox="0 0 24 24"
      fill="none"
      stroke="currentColor"
      stroke-width="2.5"
      stroke-linecap="round"
      stroke-linejoin="round"
    >
      <polyline points="20 6 9 17 4 12"></polyline>
    </svg>
    <svg
      *ngIf="toast.type === 'error'"
      xmlns="http://www.w3.org/2000/svg"
      width="20"
      height="20"
      viewBox="0 0 24 24"
      fill="none"
      stroke="currentColor"
      stroke-width="2.5"
      stroke-linecap="round"
      stroke-linejoin="round"
    >
      <circle cx="12" cy="12" r="10"></circle>
      <line x1="12" y1="8" x2="12" y2="12"></line>
      <line x1="12" y1="16" x2="12.01" y2="16"></line>
    </svg>
  </span>
  <span class="toast-message">{{ toast.message }}</span>
  <button class="toast-close" (click)="dismissToast()" aria-label="Dismiss">
    <svg
      xmlns="http://www.w3.org/2000/svg"
      width="16"
      height="16"
      viewBox="0 0 24 24"
      fill="none"
      stroke="currentColor"
      stroke-width="2.5"
      stroke-linecap="round"
      stroke-linejoin="round"
    >
      <line x1="18" y1="6" x2="6" y2="18"></line>
      <line x1="6" y1="6" x2="18" y2="18"></line>
    </svg>
  </button>
</div>

<div class="container">
  <div class="header">
    <h1>
      <svg
        xmlns="http://www.w3.org/2000/svg"
        width="48"
        height="48"
        viewBox="0 0 22 22"
        class="title-icon"
      >
        <!-- Back square -->
        <rect x="0" y="0" width="13" height="13" rx="2.5" fill="#6b83f0" />
        <!-- Middle square -->
        <rect x="3" y="3" width="13" height="13" rx="2.5" fill="#4f6aee" />
        <!-- Front square -->
        <rect x="6" y="6" width="13" height="13" rx="2.5" fill="#3d5af1" />
      </svg>
      Shelfy
    </h1>
    <div class="header-actions">
      <button class="btn-add" (click)="onAddClick()">+ Add New Book</button>
      <button
        class="theme-toggle"
        (click)="theme.toggle()"
        [title]="theme.isDark ? 'Switch to Light Mode' : 'Switch to Dark Mode'"
        aria-label="Toggle theme"
      >
        <!-- Sun icon (shown in dark mode) -->
        <svg
          *ngIf="theme.isDark"
          xmlns="http://www.w3.org/2000/svg"
          width="20"
          height="20"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
        >
          <circle cx="12" cy="12" r="5"></circle>
          <line x1="12" y1="1" x2="12" y2="3"></line>
          <line x1="12" y1="21" x2="12" y2="23"></line>
          <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
          <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
          <line x1="1" y1="12" x2="3" y2="12"></line>
          <line x1="21" y1="12" x2="23" y2="12"></line>
          <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
          <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
        </svg>
        <!-- Moon icon (shown in light mode) -->
        <svg
          *ngIf="!theme.isDark"
          xmlns="http://www.w3.org/2000/svg"
          width="20"
          height="20"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
        >
          <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
        </svg>
      </button>
    </div>
  </div>

  <div *ngIf="error" class="alert alert-error">
    {{ error }}
  </div>

  <!-- Filter Section -->
  <div class="filter-bar">
    <div class="search-input-wrapper">
      <span class="search-icon">
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="20"
          height="20"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
        >
          <circle cx="11" cy="11" r="8"></circle>
          <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
        </svg>
      </span>
      <input
        type="text"
        [(ngModel)]="searchQuery"
        (input)="onFilterChange()"
        placeholder="Search Books (Title, Author, ISBN)"
        class="search-input"
      />
    </div>

    <!-- Date Range Filter -->
    <div class="date-range-filter">
      <span class="date-range-label">
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="16"
          height="16"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
        >
          <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
          <line x1="16" y1="2" x2="16" y2="6"></line>
          <line x1="8" y1="2" x2="8" y2="6"></line>
          <line x1="3" y1="10" x2="21" y2="10"></line>
        </svg>
        Date Range
      </span>
      <div class="date-inputs">
        <div class="date-input-wrapper">
          <input type="date" [(ngModel)]="minDate" (change)="onFilterChange()" class="date-input" />
        </div>
        <span class="date-separator">â†’</span>
        <div class="date-input-wrapper">
          <input type="date" [(ngModel)]="maxDate" (change)="onFilterChange()" class="date-input" />
        </div>
      </div>
    </div>

    <button
      class="btn-clear-filters"
      (click)="onClearFilters()"
      *ngIf="searchQuery || sortBy !== 'title' || sortOrder !== 'asc' || minDate || maxDate"
    >
      <span class="clear-icon">âœ•</span> Clear Filters
    </button>
  </div>

  <!-- Advanced Filters (Collapsed/Expandable) -->
  <div class="advanced-filters" *ngIf="showAdvancedFilters">
    <div class="advanced-filter-grid">
      <!-- Sort By -->
      <div class="filter-group">
        <label for="sortBy">Sort By</label>
        <select id="sortBy" [(ngModel)]="sortBy" (change)="onFilterChange()" class="filter-input">
          <option value="title">Title</option>
          <option value="author">Author</option>
          <option value="date">Publication Date</option>
        </select>
      </div>

      <!-- Sort Order -->
      <div class="filter-group">
        <label for="sortOrder">Order</label>
        <select
          id="sortOrder"
          [(ngModel)]="sortOrder"
          (change)="onFilterChange()"
          class="filter-input"
        >
          <option value="asc">Ascending</option>
          <option value="desc">Descending</option>
        </select>
      </div>
    </div>
  </div>

  <div *ngIf="loading" class="loading">Loading books...</div>

  <div *ngIf="showForm" class="modal-overlay" (click)="onFormClose()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <app-book-form
        [book]="getBookForEdit()"
        [existingBooks]="books"
        (onSubmit)="onFormSubmit($event)"
        (onCancel)="onFormClose()"
      >
      </app-book-form>
    </div>
  </div>

  <div *ngIf="!loading && books.length === 0" class="no-books">
    <p>
      No books found.
      <strong (click)="onAddClick()" style="cursor: pointer; color: #2563eb">Add one now!</strong>
    </p>
  </div>

  <div *ngIf="!loading && books.length > 0" class="books-info">
    <p>
      Showing <strong>{{ books.length }}</strong> book(s)
    </p>
    <div class="view-toggles">
      <button [class.active]="viewMode === 'grid'" (click)="setViewMode('grid')" title="Grid View">
        ðŸ”³
      </button>
      <button [class.active]="viewMode === 'list'" (click)="setViewMode('list')" title="List View">
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="18"
          height="18"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
        >
          <rect x="3" y="5" width="4" height="4" rx="0.5"></rect>
          <line x1="9" y1="7" x2="21" y2="7"></line>
          <rect x="3" y="11" width="4" height="4" rx="0.5"></rect>
          <line x1="9" y1="13" x2="21" y2="13"></line>
          <rect x="3" y="17" width="4" height="4" rx="0.5"></rect>
          <line x1="9" y1="19" x2="21" y2="19"></line>
        </svg>
      </button>
    </div>
  </div>

  <div
    *ngIf="!loading && books.length > 0"
    [ngClass]="viewMode === 'grid' ? 'books-grid' : 'books-list'"
  >
    <app-book-item
      *ngFor="let book of paginatedBooks"
      [book]="book"
      [viewMode]="viewMode"
      (onCardClick)="onBookSelect(book)"
    >
    </app-book-item>
  </div>

  <div class="pagination" *ngIf="!loading && totalPages > 1">
    <button class="page-btn" (click)="onPageChange(currentPage - 1)" [disabled]="currentPage === 1">
      Previous
    </button>

    <span class="page-info">
      Page <strong>{{ currentPage }}</strong> of <strong>{{ totalPages }}</strong>
    </span>

    <button
      class="page-btn"
      (click)="onPageChange(currentPage + 1)"
      [disabled]="currentPage === totalPages"
    >
      Next
    </button>
  </div>
</div>
