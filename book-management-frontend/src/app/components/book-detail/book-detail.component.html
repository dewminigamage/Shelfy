<!-- Toast Notification -->
<div
  class="toast"
  [class.toast--visible]="toast.visible"
  [class.toast--error]="toast.type === 'error'"
>
  <span class="toast-icon">
    <svg
      *ngIf="toast.type === 'success'"
      xmlns="http://www.w3.org/2000/svg"
      width="20"
      height="20"
      viewBox="0 0 24 24"
      fill="none"
      stroke="currentColor"
      stroke-width="2.5"
      stroke-linecap="round"
      stroke-linejoin="round"
    >
      <polyline points="20 6 9 17 4 12"></polyline>
    </svg>
    <svg
      *ngIf="toast.type === 'error'"
      xmlns="http://www.w3.org/2000/svg"
      width="20"
      height="20"
      viewBox="0 0 24 24"
      fill="none"
      stroke="currentColor"
      stroke-width="2.5"
      stroke-linecap="round"
      stroke-linejoin="round"
    >
      <circle cx="12" cy="12" r="10"></circle>
      <line x1="12" y1="8" x2="12" y2="12"></line>
      <line x1="12" y1="16" x2="12.01" y2="16"></line>
    </svg>
  </span>
  <span class="toast-message">{{ toast.message }}</span>
  <button class="toast-close" (click)="dismissToast()" aria-label="Dismiss">
    <svg
      xmlns="http://www.w3.org/2000/svg"
      width="16"
      height="16"
      viewBox="0 0 24 24"
      fill="none"
      stroke="currentColor"
      stroke-width="2.5"
      stroke-linecap="round"
      stroke-linejoin="round"
    >
      <line x1="18" y1="6" x2="6" y2="18"></line>
      <line x1="6" y1="6" x2="18" y2="18"></line>
    </svg>
  </button>
</div>

<div class="detail-page-container">
  <div class="header">
    <button class="back-btn" (click)="onBack()">
      <span class="arrow">‹</span> Back to Dashboard
    </button>
  </div>

  <div *ngIf="loading" class="loading-state">
    <div class="spinner"></div>
    <p>Loading book details...</p>
  </div>

  <div *ngIf="error" class="error-state">
    <p>{{ error }}</p>
    <button (click)="onBack()">Return Home</button>
  </div>

  <div *ngIf="book && !loading" class="detail-content animate-fade-in">
    <!-- Left Column: Cover -->
    <div class="cover-section">
      <div class="cover-card">
        <img
          *ngIf="book.imageUrl && !imageError"
          [src]="book.imageUrl"
          [alt]="book.title"
          (error)="onImageError()"
        />
        <div *ngIf="!book.imageUrl || imageError" class="placeholder-cover">
          <span>{{ book.title[0] }}</span>
        </div>
        <div class="book-spine"></div>
      </div>
    </div>

    <!-- Right Column: Info & Actions -->
    <div class="info-section">
      <h1 class="book-title">{{ book.title }}</h1>
      <div class="book-author">
        <span class="author-icon">✍️</span>
        <span>{{ book.author }}</span>
      </div>

      <div class="info-card">
        <div class="info-item">
          <span class="label">ISBN</span>
          <span class="value">{{ book.isbn }}</span>
        </div>
        <div class="divider"></div>
        <div class="info-item">
          <span class="label">PUBLISHED</span>
          <span class="value">{{ getFormattedDate() }}</span>
        </div>
      </div>

      <div class="action-buttons">
        <button class="btn-primary" (click)="onEditClick()">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            height="20px"
            viewBox="0 -960 960 960"
            width="20px"
            fill="#ffffff"
          >
            <path
              d="M200-200h57l391-391-57-57-391 391v57Zm-80 80v-170l528-527q12-11 26.5-17t30.5-6q16 0 31 6t26 18l55 56q12 11 17.5 26t5.5 30q0 16-5.5 30.5T817-647L290-120H120Zm640-584-56-56 56 56Zm-141 85-28-29 57 57-29-28Z"
            />
          </svg>
          Edit Book
        </button>
        <button class="btn-secondary" (click)="onDeleteClick()">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            height="20px"
            viewBox="0 -960 960 960"
            width="20px"
            fill="#dc2626"
          >
            <path
              d="M280-120q-33 0-56.5-23.5T200-200v-520h-40v-80h200v-40h240v40h200v80h-40v520q0 33-23.5 56.5T680-120H280Zm400-600H280v520h400v-520ZM360-280h80v-360h-80v360Zm160 0h80v-360h-80v360ZM280-720v520-520Z"
            />
          </svg>
          Delete Book
        </button>
      </div>
    </div>
  </div>

  <!-- Edit Modal -->
  <div *ngIf="showEditForm" class="modal-backdrop" (click)="onFormCancel()">
    <div class="modal-container" (click)="$event.stopPropagation()">
      <div class="modal-body">
        <app-book-form
          [book]="book"
          [existingBooks]="[]"
          (onSubmit)="onFormSubmit($event)"
          (onCancel)="onFormCancel()"
        >
        </app-book-form>
      </div>
    </div>
  </div>
</div>
