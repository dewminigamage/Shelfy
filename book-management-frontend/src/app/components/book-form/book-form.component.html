<div class="form-wrapper">
  <div class="form-header">
    <div class="form-title">
      <div>
        <h2>{{ isEditing ? 'Edit Book' : 'Add New Book' }}</h2>
        <p class="form-subtitle">
          {{
            isEditing ? 'Update the book details below' : 'Fill in the details to add a new book'
          }}
        </p>
      </div>
    </div>
    <button class="close-btn" (click)="onCancel.emit()" title="Close">
      <svg
        xmlns="http://www.w3.org/2000/svg"
        width="18"
        height="18"
        viewBox="0 0 24 24"
        fill="none"
        stroke="currentColor"
        stroke-width="2.5"
        stroke-linecap="round"
        stroke-linejoin="round"
      >
        <line x1="18" y1="6" x2="6" y2="18"></line>
        <line x1="6" y1="6" x2="18" y2="18"></line>
      </svg>
    </button>
  </div>

  <form (ngSubmit)="submit()">
    <div class="form-grid">
      <!-- Title -->
      <div class="form-group">
        <label for="title">
          <span class="label-text">Title <span class="required-star">*</span></span>
        </label>
        <div class="input-wrapper">
          <input
            type="text"
            id="title"
            [(ngModel)]="formData.title"
            name="title"
            placeholder=""
            class="form-control"
            [class.is-invalid]="errors['title']"
            maxlength="100"
          />
        </div>
        <div class="field-footer">
          <div *ngIf="errors['title']" class="error-message">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="14"
              height="14"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <circle cx="12" cy="12" r="10"></circle>
              <line x1="12" y1="8" x2="12" y2="12"></line>
              <line x1="12" y1="16" x2="12.01" y2="16"></line>
            </svg>
            {{ errors['title'] }}
          </div>
          <span class="char-count">{{ formData.title.length }}/100</span>
        </div>
      </div>

      <!-- Author -->
      <div class="form-group">
        <label for="author">
          <span class="label-text">Author <span class="required-star">*</span></span>
        </label>
        <div class="input-wrapper">
          <input
            type="text"
            id="author"
            [(ngModel)]="formData.author"
            name="author"
            placeholder=""
            class="form-control"
            [class.is-invalid]="errors['author']"
            maxlength="50"
          />
        </div>
        <div class="field-footer">
          <div *ngIf="errors['author']" class="error-message">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="14"
              height="14"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <circle cx="12" cy="12" r="10"></circle>
              <line x1="12" y1="8" x2="12" y2="12"></line>
              <line x1="12" y1="16" x2="12.01" y2="16"></line>
            </svg>
            {{ errors['author'] }}
          </div>
          <span class="char-count">{{ formData.author.length }}/50</span>
        </div>
      </div>

      <!-- ISBN -->
      <div class="form-group">
        <label for="isbn">
          <span class="label-text">ISBN <span class="required-star">*</span></span>
        </label>
        <div class="input-wrapper">
          <input
            type="text"
            id="isbn"
            [(ngModel)]="formData.isbn"
            name="isbn"
            placeholder="e.g., 978-0-7432-7356-5"
            class="form-control"
            [class.is-invalid]="errors['isbn']"
          />
        </div>
        <div class="field-footer">
          <div *ngIf="errors['isbn']" class="error-message">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="14"
              height="14"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <circle cx="12" cy="12" r="10"></circle>
              <line x1="12" y1="8" x2="12" y2="12"></line>
              <line x1="12" y1="16" x2="12.01" y2="16"></line>
            </svg>
            {{ errors['isbn'] }}
          </div>
          <span class="help-text" *ngIf="!errors['isbn']">10 or 13 digits, hyphens optional</span>
        </div>
      </div>

      <!-- Publication Date -->
      <div class="form-group">
        <label for="publicationDate">
          <span class="label-text">Publication Date <span class="required-star">*</span></span>
        </label>
        <div class="input-wrapper">
          <input
            type="date"
            id="publicationDate"
            [(ngModel)]="formData.publicationDate"
            name="publicationDate"
            class="form-control"
            [max]="todayDate"
          />
        </div>
        <div class="field-footer">
          <div *ngIf="errors['date']" class="error-message">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="14"
              height="14"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <circle cx="12" cy="12" r="10"></circle>
              <line x1="12" y1="8" x2="12" y2="12"></line>
              <line x1="12" y1="16" x2="12.01" y2="16"></line>
            </svg>
            {{ errors['date'] }}
          </div>
        </div>
      </div>
    </div>

    <!-- Image Upload (full width) -->
    <div class="form-group">
      <label for="bookImage">
        <span class="label-text">Book Cover</span>
      </label>
      <div class="image-upload-container">
        <input
          type="file"
          id="bookImage"
          (change)="onFileSelected($event)"
          accept="image/*"
          class="file-input"
          #fileInput
        />
        <div class="image-preview" (click)="fileInput.click()" [class.has-image]="!!imagePreview">
          <img *ngIf="imagePreview" [src]="imagePreview" alt="Book Cover Preview" />
          <div *ngIf="!imagePreview" class="upload-placeholder">
            <div class="upload-icon-wrap">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="28"
                height="28"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="1.5"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                <circle cx="8.5" cy="8.5" r="1.5"></circle>
                <polyline points="21 15 16 10 5 21"></polyline>
              </svg>
            </div>
            <span class="upload-label">Click to upload cover image</span>
            <span class="upload-hint">PNG, JPG, WEBP up to 5MB</span>
          </div>
        </div>
        <button
          *ngIf="imagePreview"
          type="button"
          class="btn-remove-image"
          (click)="imagePreview = null; formData.imageUrl = ''; fileInput.value = ''"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            height="16px"
            viewBox="0 -960 960 960"
            width="16px"
            fill="currentColor"
          >
            <path
              d="M280-120q-33 0-56.5-23.5T200-200v-520h-40v-80h200v-40h240v40h200v80h-40v520q0 33-23.5 56.5T680-120H280Zm400-600H280v520h400v-520ZM360-280h80v-360h-80v360Zm160 0h80v-360h-80v360ZM280-720v520-520Z"
            />
          </svg>
          Remove Image
        </button>
      </div>
    </div>

    <div class="form-actions">
      <button type="button" class="btn btn-cancel" (click)="onCancel.emit()">Cancel</button>
      <button type="submit" class="btn btn-submit" [disabled]="!isValidForm()">
        <svg
          *ngIf="isEditing"
          xmlns="http://www.w3.org/2000/svg"
          height="18px"
          viewBox="0 -960 960 960"
          width="18px"
          fill="#ffffff"
        >
          <path
            d="M200-200h57l391-391-57-57-391 391v57Zm-80 80v-170l528-527q12-11 26.5-17t30.5-6q16 0 31 6t26 18l55 56q12 11 17.5 26t5.5 30q0 16-5.5 30.5T817-647L290-120H120Zm640-584-56-56 56 56Zm-141 85-28-29 57 57-29-28Z"
          />
        </svg>
        {{ isEditing ? 'Save Changes' : 'Add Book' }}
      </button>
    </div>
  </form>
</div>
